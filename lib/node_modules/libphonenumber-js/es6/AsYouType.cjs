"use client";"use strict";const h=require("./metadata.cjs"),C=require("./PhoneNumber.cjs"),m=require("./AsYouTypeState.cjs"),y=require("./AsYouTypeFormatter.cjs"),b=require("./AsYouTypeParser.cjs"),v=require("./helpers/getCountryByCallingCode.cjs"),N=require("./helpers/getCountryByNationalNumber.cjs"),p=require("./helpers/isObject.cjs"),_=require("./AsYouTypeFormatter.util.cjs");function T(a,e){return S(a)||P(a,e)||A(a,e)||k()}function k(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A(a,e){if(a){if(typeof a=="string")return g(a,e);var t=Object.prototype.toString.call(a).slice(8,-1);if(t==="Object"&&a.constructor&&(t=a.constructor.name),t==="Map"||t==="Set")return Array.from(a);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return g(a,e)}}function g(a,e){(e==null||e>a.length)&&(e=a.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=a[t];return n}function P(a,e){var t=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(t!=null){var n=[],i=!0,u=!1,r,o;try{for(t=t.call(a);!(i=(r=t.next()).done)&&(n.push(r.value),!(e&&n.length===e));i=!0);}catch(s){u=!0,o=s}finally{try{!i&&t.return!=null&&t.return()}finally{if(u)throw o}}return n}}function S(a){if(Array.isArray(a))return a}function I(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function c(a,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function F(a,e,t){return e&&c(a.prototype,e),t&&c(a,t),Object.defineProperty(a,"prototype",{writable:!1}),a}var w=function(){function a(e,t){I(this,a),this.metadata=new h.default(t);var n=this.getCountryAndCallingCode(e),i=T(n,2),u=i[0],r=i[1];this.defaultCountry=u,this.defaultCallingCode=r,this.reset()}return F(a,[{key:"getCountryAndCallingCode",value:function(t){var n,i;return t&&(p(t)?(n=t.defaultCountry,i=t.defaultCallingCode):n=t),n&&!this.metadata.hasCountry(n)&&(n=void 0),[n,i]}},{key:"input",value:function(t){var n=this.parser.input(t,this.state),i=n.digits,u=n.justLeadingPlus;if(u)this.formattedOutput="+";else if(i){this.determineTheCountryIfNeeded(),this.state.nationalSignificantNumber&&this.formatter.narrowDownMatchingFormats(this.state);var r;if(this.metadata.hasSelectedNumberingPlan()&&(r=this.formatter.format(i,this.state)),r===void 0&&this.parser.reExtractNationalSignificantNumber(this.state)){this.determineTheCountryIfNeeded();var o=this.state.getNationalDigits();o&&(r=this.formatter.format(o,this.state))}this.formattedOutput=r?this.getFullNumber(r):this.getNonFormattedNumber()}return this.formattedOutput}},{key:"reset",value:function(){var t=this;return this.state=new m({onCountryChange:function(i){t.country=i},onCallingCodeChange:function(i,u){t.metadata.selectNumberingPlan(u,i),t.formatter.reset(t.metadata.numberingPlan,t.state),t.parser.reset(t.metadata.numberingPlan)}}),this.formatter=new y.default({state:this.state,metadata:this.metadata}),this.parser=new b.default({defaultCountry:this.defaultCountry,defaultCallingCode:this.defaultCallingCode,metadata:this.metadata,state:this.state,onNationalSignificantNumberChange:function(){t.determineTheCountryIfNeeded(),t.formatter.reset(t.metadata.numberingPlan,t.state)}}),this.state.reset({country:this.defaultCountry,callingCode:this.defaultCallingCode}),this.formattedOutput="",this}},{key:"isInternational",value:function(){return this.state.international}},{key:"getCallingCode",value:function(){if(this.isInternational())return this.state.callingCode}},{key:"getCountryCallingCode",value:function(){return this.getCallingCode()}},{key:"getCountry",value:function(){var t=this.state.digits;if(t)return this._getCountry()}},{key:"_getCountry",value:function(){var t=this.state.country;return t}},{key:"determineTheCountryIfNeeded",value:function(){(!this.state.country||this.isCountryCallingCodeAmbiguous())&&this.determineTheCountry()}},{key:"getFullNumber",value:function(t){var n=this;if(this.isInternational()){var i=function(o){return n.formatter.getInternationalPrefixBeforeCountryCallingCode(n.state,{spacing:!!o})+o},u=this.state.callingCode;return i(u?t?"".concat(u," ").concat(t):u:"".concat(this.state.getDigitsWithoutInternationalPrefix()))}return t}},{key:"getNonFormattedNationalNumberWithPrefix",value:function(){var t=this.state,n=t.nationalSignificantNumber,i=t.complexPrefixBeforeNationalSignificantNumber,u=t.nationalPrefix,r=n,o=i||u;return o&&(r=o+r),r}},{key:"getNonFormattedNumber",value:function(){var t=this.state.nationalSignificantNumberMatchesInput;return this.getFullNumber(t?this.getNonFormattedNationalNumberWithPrefix():this.state.getNationalDigits())}},{key:"getNonFormattedTemplate",value:function(){var t=this.getNonFormattedNumber();if(t)return t.replace(/[\+\d]/g,_.DIGIT_PLACEHOLDER)}},{key:"isCountryCallingCodeAmbiguous",value:function(){var t=this.state.callingCode,n=this.metadata.getCountryCodesForCallingCode(t);return n&&n.length>1}},{key:"determineTheCountry",value:function(){this.state.setCountry(v(this.isInternational()?this.state.callingCode:this.defaultCallingCode,{nationalNumber:this.state.nationalSignificantNumber,defaultCountry:this.defaultCountry,metadata:this.metadata}))}},{key:"getNumberValue",value:function(){var t=this.state,n=t.digits,i=t.callingCode,u=t.country,r=t.nationalSignificantNumber;if(n){if(this.isInternational())return i?"+"+i+r:"+"+n;if(u||i){var o=u?this.metadata.countryCallingCode():i;return"+"+o+r}}}},{key:"getNumber",value:function(){var t=this.state,n=t.nationalSignificantNumber,i=t.carrierCode,u=t.callingCode,r=this._getCountry();if(n&&!(!r&&!u)){if(r&&r===this.defaultCountry){var o=new h.default(this.metadata.metadata);o.selectNumberingPlan(r);var s=o.numberingPlan.callingCode(),l=this.metadata.getCountryCodesForCallingCode(s);if(l.length>1){var f=N(n,{countries:l,defaultCountry:this.defaultCountry,metadata:this.metadata.metadata});f&&(r=f)}}var d=new C(r||u,n,this.metadata.metadata);return i&&(d.carrierCode=i),d}}},{key:"isPossible",value:function(){var t=this.getNumber();return t?t.isPossible():!1}},{key:"isValid",value:function(){var t=this.getNumber();return t?t.isValid():!1}},{key:"getNationalNumber",value:function(){return this.state.nationalSignificantNumber}},{key:"getChars",value:function(){return(this.state.international?"+":"")+this.state.digits}},{key:"getTemplate",value:function(){return this.formatter.getTemplate(this.state)||this.getNonFormattedTemplate()||""}}]),a}();module.exports=w;
