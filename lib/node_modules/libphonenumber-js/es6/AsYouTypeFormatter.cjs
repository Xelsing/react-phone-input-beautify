"use client";"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const l=require("./AsYouTypeFormatter.util.cjs"),F=require("./AsYouTypeFormatter.complete.cjs"),b=require("./AsYouTypeFormatter.PatternMatcher.cjs"),v=require("./helpers/parseDigits.cjs"),D=require("./helpers/formatNationalNumberUsingFormat.cjs"),N=require("./constants.cjs"),E=require("./helpers/applyInternationalSeparatorStyle.cjs");function d(r,a){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t)return(t=t.call(r)).next.bind(t);if(Array.isArray(r)||(t=R(r))||a&&r&&typeof r.length=="number"){t&&(r=t);var e=0;return function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function R(r,a){if(r){if(typeof r=="string")return y(r,a);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return y(r,a)}}function y(r,a){(a==null||a>r.length)&&(a=r.length);for(var t=0,e=new Array(a);t<a;t++)e[t]=r[t];return e}function _(r,a){if(!(r instanceof a))throw new TypeError("Cannot call a class as a function")}function A(r,a){for(var t=0;t<a.length;t++){var e=a[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function O(r,a,t){return a&&A(r.prototype,a),t&&A(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}var g="9",S=15,C=l.repeat(g,S),L=/[- ]/,k=function(){return/\[([^\[\]])*\]/g},w=function(){return/\d(?=[^,}][^,}])/g},G=new RegExp("["+N.VALID_PUNCTUATION+"]*\\$1["+N.VALID_PUNCTUATION+"]*(\\$\\d["+N.VALID_PUNCTUATION+"]*)*$"),I=3,M=function(){function r(a){a.state;var t=a.metadata;_(this,r),this.metadata=t,this.resetFormat()}return O(r,[{key:"resetFormat",value:function(){this.chosenFormat=void 0,this.template=void 0,this.nationalNumberTemplate=void 0,this.populatedNationalNumberTemplate=void 0,this.populatedNationalNumberTemplatePosition=-1}},{key:"reset",value:function(t,e){this.resetFormat(),t?(this.isNANP=t.callingCode()==="1",this.matchingFormats=t.formats(),e.nationalSignificantNumber&&this.narrowDownMatchingFormats(e)):(this.isNANP=void 0,this.matchingFormats=[])}},{key:"format",value:function(t,e){var n=this;if(F.canFormatCompleteNumber(e.nationalSignificantNumber,this.metadata))for(var i=d(this.matchingFormats),o;!(o=i()).done;){var f=o.value,u=F.default(e,f,{metadata:this.metadata,shouldTryNationalPrefixFormattingRule:function(m){return n.shouldTryNationalPrefixFormattingRule(m,{international:e.international,nationalPrefix:e.nationalPrefix})},getSeparatorAfterNationalPrefix:function(m){return n.getSeparatorAfterNationalPrefix(m)}});if(u)return this.resetFormat(),this.chosenFormat=f,this.setNationalNumberTemplate(u.replace(/\d/g,l.DIGIT_PLACEHOLDER),e),this.populatedNationalNumberTemplate=u,this.populatedNationalNumberTemplatePosition=this.template.lastIndexOf(l.DIGIT_PLACEHOLDER),u}return this.formatNationalNumberWithNextDigits(t,e)}},{key:"formatNationalNumberWithNextDigits",value:function(t,e){var n=this.chosenFormat,i=this.chooseFormat(e);if(i)return i===n?this.formatNextNationalNumberDigits(t):this.formatNextNationalNumberDigits(e.getNationalDigits())}},{key:"narrowDownMatchingFormats",value:function(t){var e=this,n=t.nationalSignificantNumber,i=t.nationalPrefix,o=t.international,f=n,u=f.length-I;u<0&&(u=0),this.matchingFormats=this.matchingFormats.filter(function(s){return e.formatSuits(s,o,i)&&e.formatMatches(s,f,u)}),this.chosenFormat&&this.matchingFormats.indexOf(this.chosenFormat)===-1&&this.resetFormat()}},{key:"formatSuits",value:function(t,e,n){return!(n&&!t.usesNationalPrefix()&&!t.nationalPrefixIsOptionalWhenFormattingInNationalFormat()||!e&&!n&&t.nationalPrefixIsMandatoryWhenFormattingInNationalFormat())}},{key:"formatMatches",value:function(t,e,n){var i=t.leadingDigitsPatterns().length;if(i===0)return!0;n=Math.min(n,i-1);var o=t.leadingDigitsPatterns()[n];if(e.length<I)try{return new b(o).match(e,{allowOverflow:!0})!==void 0}catch(f){return console.error(f),!0}return new RegExp("^(".concat(o,")")).test(e)}},{key:"getFormatFormat",value:function(t,e){return e?t.internationalFormat():t.format()}},{key:"chooseFormat",value:function(t){for(var e=this,n=function(){var s=o.value;return e.chosenFormat===s?"break":G.test(e.getFormatFormat(s,t.international))?e.createTemplateForFormat(s,t)?(e.chosenFormat=s,"break"):(e.matchingFormats=e.matchingFormats.filter(function(m){return m!==s}),"continue"):"continue"},i=d(this.matchingFormats.slice()),o;!(o=i()).done;){var f=n();if(f==="break")break}return this.chosenFormat||this.resetFormat(),this.chosenFormat}},{key:"createTemplateForFormat",value:function(t,e){if(!(t.pattern().indexOf("|")>=0)){var n=this.getTemplateForFormat(t,e);if(n)return this.setNationalNumberTemplate(n,e),!0}}},{key:"getSeparatorAfterNationalPrefix",value:function(t){return this.isNANP||t&&t.nationalPrefixFormattingRule()&&L.test(t.nationalPrefixFormattingRule())?" ":""}},{key:"getInternationalPrefixBeforeCountryCallingCode",value:function(t,e){var n=t.IDDPrefix,i=t.missingPlus;return n?e&&e.spacing===!1?n:n+" ":i?"":"+"}},{key:"getTemplate",value:function(t){if(this.template){for(var e=-1,n=0,i=t.international?this.getInternationalPrefixBeforeCountryCallingCode(t,{spacing:!1}):"";n<i.length+t.getDigitsWithoutInternationalPrefix().length;)e=this.template.indexOf(l.DIGIT_PLACEHOLDER,e+1),n++;return l.cutAndStripNonPairedParens(this.template,e+1)}}},{key:"setNationalNumberTemplate",value:function(t,e){this.nationalNumberTemplate=t,this.populatedNationalNumberTemplate=t,this.populatedNationalNumberTemplatePosition=-1,e.international?this.template=this.getInternationalPrefixBeforeCountryCallingCode(e).replace(/[\d\+]/g,l.DIGIT_PLACEHOLDER)+l.repeat(l.DIGIT_PLACEHOLDER,e.callingCode.length)+" "+t:this.template=t}},{key:"getTemplateForFormat",value:function(t,e){var n=e.nationalSignificantNumber,i=e.international,o=e.nationalPrefix,f=e.complexPrefixBeforeNationalSignificantNumber,u=t.pattern();u=u.replace(k(),"\\d").replace(w(),"\\d");var s=C.match(u)[0];if(!(n.length>s.length)){var m=new RegExp("^"+u+"$"),p=n.replace(/\d/g,g);m.test(p)&&(s=p);var c=this.getFormatFormat(t,i),T;if(this.shouldTryNationalPrefixFormattingRule(t,{international:i,nationalPrefix:o})){var x=c.replace(D.FIRST_GROUP_PATTERN,t.nationalPrefixFormattingRule());if(v.default(t.nationalPrefixFormattingRule())===(o||"")+v.default("$1")&&(c=x,T=!0,o))for(var P=o.length;P>0;)c=c.replace(/\d/,l.DIGIT_PLACEHOLDER),P--}var h=s.replace(new RegExp(u),c).replace(new RegExp(g,"g"),l.DIGIT_PLACEHOLDER);return T||(f?h=l.repeat(l.DIGIT_PLACEHOLDER,f.length)+" "+h:o&&(h=l.repeat(l.DIGIT_PLACEHOLDER,o.length)+this.getSeparatorAfterNationalPrefix(t)+h)),i&&(h=E(h)),h}}},{key:"formatNextNationalNumberDigits",value:function(t){var e=l.populateTemplateWithDigits(this.populatedNationalNumberTemplate,this.populatedNationalNumberTemplatePosition,t);if(!e){this.resetFormat();return}return this.populatedNationalNumberTemplate=e[0],this.populatedNationalNumberTemplatePosition=e[1],l.cutAndStripNonPairedParens(this.populatedNationalNumberTemplate,this.populatedNationalNumberTemplatePosition+1)}},{key:"shouldTryNationalPrefixFormattingRule",value:function(t,e){var n=e.international,i=e.nationalPrefix;if(t.nationalPrefixFormattingRule()){var o=t.usesNationalPrefix();if(o&&i||!o&&!n)return!0}}}]),r}();exports.DIGIT_PLACEHOLDER=l.DIGIT_PLACEHOLDER;exports.default=M;
