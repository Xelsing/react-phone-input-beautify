"use client";"use strict";const _=require("./constants.cjs"),C=require("./ParseError.cjs"),h=require("./metadata.cjs"),d=require("./helpers/isViablePhoneNumber.cjs"),T=require("./helpers/extension/extractExtension.cjs"),g=require("./parseIncompletePhoneNumber.cjs"),P=require("./isPossible.cjs"),m=require("./PhoneNumber.cjs"),O=require("./helpers/matchesEntirely.cjs"),v=require("./helpers/extractCountryCallingCode.cjs"),S=require("./helpers/extractNationalNumber.cjs"),w=require("./helpers/getCountryByCallingCode.cjs"),x=require("./helpers/extractFormattedPhoneNumberFromPossibleRfc3966NumberUri.cjs");var R=250,E=new RegExp("["+_.PLUS_CHARS+_.VALID_DIGITS+"]"),I=new RegExp("[^"+_.VALID_DIGITS+"#]+$");function q(t,r,n){if(r=r||{},n=new h.default(n),r.defaultCountry&&!n.hasCountry(r.defaultCountry))throw r.v2?new C("INVALID_COUNTRY"):new Error("Unknown country: ".concat(r.defaultCountry));var e=L(t,r.v2,r.extract),c=e.number,a=e.ext,i=e.error;if(!c){if(r.v2)throw i==="TOO_SHORT"?new C("TOO_SHORT"):new C("NOT_A_NUMBER");return{}}var l=U(c,r.defaultCountry,r.defaultCallingCode,n),o=l.country,u=l.nationalNumber,f=l.countryCallingCode,b=l.countryCallingCodeSource,N=l.carrierCode;if(!n.hasSelectedNumberingPlan()){if(r.v2)throw new C("INVALID_COUNTRY");return{}}if(!u||u.length<_.MIN_LENGTH_FOR_NSN){if(r.v2)throw new C("TOO_SHORT");return{}}if(u.length>_.MAX_LENGTH_FOR_NSN){if(r.v2)throw new C("TOO_LONG");return{}}if(r.v2){var s=new m(f,u,n.metadata);return o&&(s.country=o),N&&(s.carrierCode=N),a&&(s.ext=a),s.__countryCallingCodeSource=b,s}var y=(r.extended?n.hasSelectedNumberingPlan():o)?O(u,n.nationalNumberPattern()):!1;return r.extended?{country:o,countryCallingCode:f,carrierCode:N,valid:y,possible:y?!0:!!(r.extended===!0&&n.possibleLengths()&&P.isPossibleNumber(u,n)),phone:u,ext:a}:y?H(o,u,a):{}}function A(t,r,n){if(t){if(t.length>R){if(n)throw new C("TOO_LONG");return}if(r===!1)return t;var e=t.search(E);if(!(e<0))return t.slice(e).replace(I,"")}}function L(t,r,n){var e=x(t,{extractFormattedPhoneNumber:function(i){return A(i,n,r)}});if(!e)return{};if(!d.default(e))return d.isViablePhoneNumberStart(e)?{error:"TOO_SHORT"}:{};var c=T(e);return c.ext?c:{number:e}}function H(t,r,n){var e={country:t,phone:r};return n&&(e.ext=n),e}function U(t,r,n,e){var c=v(g.default(t),r,n,e.metadata),a=c.countryCallingCodeSource,i=c.countryCallingCode,l=c.number,o;if(i)e.selectNumberingPlan(i);else if(l&&(r||n))e.selectNumberingPlan(r,n),r&&(o=r),i=n||h.getCountryCallingCode(r,e.metadata);else return{};if(!l)return{countryCallingCodeSource:a,countryCallingCode:i};var u=S(g.default(l),e),f=u.nationalNumber,b=u.carrierCode,N=w(i,{nationalNumber:f,defaultCountry:r,metadata:e});return N&&(o=N,N==="001"||e.country(o)),{country:o,countryCallingCode:i,countryCallingCodeSource:a,nationalNumber:f,carrierCode:b}}module.exports=q;
